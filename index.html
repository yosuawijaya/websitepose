<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0e1a38" />
  <title>VirtuShoot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root { --brand1:#0ea5e9; --brand2:#8b5cf6; --ink:#0b1020; }
    body { font-family:'Montserrat','Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif; background: radial-gradient(1200px 600px at 20% -10%, rgba(255,255,255,0.08), transparent), linear-gradient(135deg,#0b1225 0%, #0e1a38 50%, #111827 100%); color:#e5eefc; }
    .glass { background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.06)); box-shadow: 0 10px 30px rgba(0,0,0,.35); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.12); }
    .chip { background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06)); border: 1px solid rgba(255,255,255,0.14); }
    .btn { background: linear-gradient(180deg,#22d3ee,#0ea5e9); color:#fff; box-shadow:0 6px 20px rgba(14,165,233,.35); transition: filter .15s ease, transform .06s ease; }
    .btn:hover { filter:brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .btn-red { background: linear-gradient(180deg,#ef4444,#dc2626); color:#fff; box-shadow:0 6px 20px rgba(239,68,68,.28); }
    .tab-active { background: linear-gradient(180deg, rgba(255,255,255,0.16), rgba(255,255,255,0.08)); border: 1px solid rgba(255,255,255,0.18); color:#fff; }
    .fade-in { animation: fadein .45s ease both; } @keyframes fadein { from {opacity:0} to {opacity:1} }
    .slide-up { animation: slideup .45s ease both; } @keyframes slideup { from {transform:translateY(14px); opacity:0} to {transform:translateY(0); opacity:1} }
    .grid-auto-fit { display:grid; grid-template-columns:repeat(auto-fill, minmax(120px, 1fr)); gap:12px; }
    .hidden-scroll::-webkit-scrollbar { display:none; } .hidden-scroll { -ms-overflow-style:none; scrollbar-width:none; }
    .empty { border: 1px dashed rgba(255,255,255,.15); background: rgba(255,255,255,.04); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Top Progress -->
  <div id="quickLoader" class="fixed top-0 left-0 right-0 z-50 h-1 bg-sky-300/30">
    <div id="quickLoaderBar" class="h-1 bg-sky-400" style="width:0%"></div>
  </div>

  <!-- HERO -->
  <header class="max-w-5xl mx-auto px-4 sm:px-6 pt-6 sm:pt-8 fade-in">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl grid place-items-center" style="background: linear-gradient(180deg,#22d3ee,#0ea5e9); box-shadow: 0 6px 18px rgba(14,165,233,.35);">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 8h16v10H4z" stroke="white" opacity=".9" stroke-width="1.6"/><path d="M4 8l4-4h8l4 4" stroke="white" opacity=".9" stroke-width="1.6"/></svg>
        </div>
        <div>
          <h1 class="text-xl font-extrabold">VirtuShoot</h1>
          <p class="text-slate-300 text-sm">VirtuShoot â€” dibuat khusus untuk fotografer pose.</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="goAdmin" class="chip rounded-xl px-3 py-2 text-sm hover:brightness-110 hidden">Panel Admin</button>
        <button id="installPWA" class="btn rounded-xl px-3 py-2 text-sm hidden">Pasang Aplikasi</button>
        <button id="logoutTop" class="btn-red rounded-xl px-3 py-2 text-sm">Keluar</button>
      </div>
    </div>
  </header>

  <!-- AUTH -->
  <div id="authWrapper" class="max-w-md mx-auto min-h-[78vh] px-6 py-6">
    <div class="glass rounded-2xl p-5 space-y-5 slide-up">
      <div class="grid grid-cols-2 gap-2">
        <button id="tabSignIn" type="button" class="rounded-xl py-2 text-center tab-active">Masuk</button>
        <button id="tabCreate" type="button" class="rounded-xl py-2 text-center">Daftar</button>
      </div>

      <div id="panelSignIn" class="space-y-4">
        <div class="bg-black/20 rounded-xl p-3 text-sm">
          <p class="text-slate-300">Akses lokal di perangkatmu. Tanpa kata sandi.</p>
        </div>
        <div class="space-y-2">
          <label class="text-sm">Nama</label>
          <input id="siName" inputmode="text" autocomplete="name" placeholder="Nama lengkap" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
        </div>
        <div class="space-y-2">
          <label class="text-sm">Email</label>
          <input id="siEmail" type="email" inputmode="email" autocomplete="email" placeholder="nama@contoh.com" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
        </div>
        <button id="btnSignIn" type="button" class="btn rounded-xl px-4 py-3 w-full flex items-center justify-center gap-2">
          <span class="inline-block">Masuk Sekarang</span>
          <span id="siSpinner" class="hidden w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
        </button>
        <p class="text-xs text-slate-400 text-center">Data tersimpan di perangkat ini.</p>
      </div>

      <div id="panelCreate" class="space-y-4 hidden">
        <div class="bg-black/20 rounded-xl p-3 text-sm">
          <p class="text-slate-300">Buat profil agar favorit & portal tersimpan.</p>
        </div>
        <div class="space-y-2">
          <label class="text-sm">Nama</label>
          <input id="caName" inputmode="text" autocomplete="name" placeholder="Nama lengkap" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-violet-400/60"/>
        </div>
        <div class="space-y-2">
          <label class="text-sm">Email</label>
          <input id="caEmail" type="email" inputmode="email" autocomplete="email" placeholder="nama@contoh.com" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-violet-400/60"/>
        </div>
        <button id="btnCreate" type="button" class="btn rounded-xl px-4 py-3 w-full flex items-center justify-center gap-2" style="background: linear-gradient(180deg,#8b5cf6,#6d28d9);">
          <span class="inline-block">Buat Profil</span>
          <span id="caSpinner" class="hidden w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
        </button>
        <p class="text-xs text-slate-400 text-center">Tidak ada data dikirim ke server.</p>
      </div>
    </div>
  </div>

  <!-- App -->
  <div id="appWrapper" class="max-w-md mx-auto min-h-screen flex flex-col relative hidden sm:max-w-lg">
    <main id="mainContent" class="flex-1 px-5 pb-24 pt-5 space-y-6">
      <section id="tab-dashboard" class="fade-in space-y-5">
        <div class="text-center">
          <h2 class="text-xl font-extrabold">Dashboard</h2>
          <p class="text-slate-300 text-sm">Mulai dengan menambah kategori dan upload foto.</p>
        </div>

        <div class="sticky top-2 z-30">
          <input id="searchInput" placeholder="Cari kategori..." class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 placeholder-slate-300 focus:outline-none focus:ring-2 focus:ring-sky-400/60" />
        </div>

        <div class="grid grid-cols-3 gap-3">
          <button id="qaNewPortal" class="chip rounded-xl px-3 py-3 text-center hover:brightness-110 transition">
            <div class="w-9 h-9 mx-auto rounded-lg grid place-items-center mb-1" style="background: linear-gradient(180deg,#8b5cf6,#6d28d9); box-shadow: 0 6px 16px rgba(139,92,246,.35);">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="white" stroke-width="1.8" stroke-linecap="round"/></svg>
            </div>
            <div class="text-xs">Buat Portal</div>
          </button>
          <button id="qaCollections" class="chip rounded-xl px-3 py-3 text-center hover:brightness-110 transition">
            <div class="w-9 h-9 mx-auto rounded-lg grid place-items-center mb-1" style="background: linear-gradient(180deg,#22d3ee,#0ea5e9); box-shadow: 0 6px 16px rgba(14,165,233,.35);">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M6 11h12M8 15h8" stroke="white" stroke-width="1.8" stroke-linecap="round"/></svg>
            </div>
            <div class="text-xs">Favorit</div>
          </button>
          <button id="qaSuggest" class="chip rounded-xl px-3 py-3 text-center hover:brightness-110 transition">
            <div class="w-9 h-9 mx-auto rounded-lg grid place-items-center mb-1" style="background: linear-gradient(180deg,#f59e0b,#d97706); box-shadow: 0 6px 16px rgba(217,119,6,.35);">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M12 3a6 6 0 0 1 6 6c0 2.2-1.2 3.9-2.8 5.2-.5.4-.7.9-.7 1.5v.3H9.5v-.3c0-.6-.2-1.1-.7-1.5C7.2 12.9 6 11.2 6 9a6 6 0 0 1 6-6z" stroke="white" stroke-width="1.5"/>
                <rect x="9.5" y="17" width="5" height="2.2" rx="1" fill="white" opacity=".9"/>
              </svg>
            </div>
            <div class="text-xs">Sugesti</div>
          </button>
        </div>

        <div class="space-y-3">
          <h3 class="font-semibold text-slate-100">Kategori</h3>
          <div id="categoryList" class="space-y-3"></div>
          <div id="emptyCategoriesHint" class="empty rounded-xl p-4 text-slate-300 text-sm hidden">
            Belum ada kategori. Tambahkan kategori di Panel Admin.
          </div>
        </div>
      </section>

      <section id="tab-collections" class="hidden space-y-4">
        <div class="glass rounded-2xl p-4">
          <h3 class="font-semibold">Favorit Anda</h3>
          <p class="text-slate-300 text-sm">Tandai foto dengan hati untuk muncul di sini.</p>
        </div>
        <div id="collectionsGrid" class="grid-auto-fit"></div>
        <div id="emptyFavs" class="empty rounded-xl p-4 text-slate-300 text-sm">
          Belum ada favorit. Buka kategori lalu tekan ikon hati pada foto.
        </div>
      </section>

      <section id="tab-portals" class="hidden space-y-4">
        <div class="glass rounded-2xl p-4 space-y-3">
          <div class="flex items-center justify-between">
            <h3 class="font-semibold">Portals</h3>
            <button id="btnCreatePortal" class="btn rounded-xl px-4 py-2 text-sm">Buat Portal</button>
          </div>
          <p class="text-slate-300 text-sm">Bagikan pilihan foto ke klien dan kumpulkan suka.</p>
        </div>
        <div id="portalList" class="space-y-3"></div>
      </section>

      <section id="tab-profile" class="hidden space-y-4">
        <div class="glass rounded-2xl p-4 space-y-4">
          <div class="flex items-center gap-3">
            <div id="avatar" class="w-12 h-12 rounded-2xl grid place-items-center text-xl overflow-hidden bg-white/10 border border-white/20">ðŸ“·</div>
            <div class="flex-1">
              <div class="text-sm text-slate-300">Profil</div>
              <h3 id="profileName" class="font-semibold">Fotografer Tanpa Nama</h3>
            </div>
          </div>
          <div class="space-y-3">
            <div class="space-y-2">
              <label class="text-sm">Foto Profil</label>
              <div class="flex items-center gap-3">
                <img id="profilePhotoPreview" class="w-16 h-16 rounded-xl object-cover bg-white/10 border border-white/20" alt="Pratinjau"/>
                <div class="flex flex-col gap-2">
                  <input id="profilePhotoInput" type="file" accept="image/*" class="hidden"/>
                  <div class="flex gap-2">
                    <button id="choosePhoto" class="btn rounded-xl px-3 py-2 text-sm">Pilih Foto</button>
                    <button id="removePhoto" class="chip rounded-xl px-3 py-2 text-sm">Hapus</button>
                  </div>
                  <div class="text-[11px] text-slate-400">Disimpan di perangkat Anda.</div>
                </div>
              </div>
            </div>
            <label class="text-sm">Nama Tampilan</label>
            <input id="inputName" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 placeholder-slate-300 focus:outline-none focus:ring-2 focus:ring-sky-400/60" placeholder="Tulis nama Anda..." />
            <label class="text-sm">Tentang Saya</label>
            <textarea id="inputBio" rows="3" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 placeholder-slate-300 focus:outline-none focus:ring-2 focus:ring-sky-400/60" placeholder="Ceritakan singkat tentang diri Anda..."></textarea>
            <button id="saveProfile" class="btn rounded-xl px-4 py-3 w-full">Simpan Profil</button>
          </div>
        </div>
      </section>

      <section id="categoryScreen" class="hidden space-y-4">
        <div class="flex items-center justify-between">
          <button id="backToDash" class="btn rounded-xl px-3 py-2">Kembali</button>
          <h3 id="categoryTitle" class="font-semibold">Kategori</h3>
          <div></div>
        </div>
        <div id="categoryGrid" class="grid-auto-fit"></div>
        <div id="emptyGrid" class="empty rounded-xl p-4 text-slate-300 text-sm">
          Belum ada foto di kategori ini. Tambahkan lewat Panel Admin.
        </div>
      </section>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 z-40">
      <div class="max-w-md mx-auto px-4 pb-4">
        <div class="glass rounded-2xl px-3 py-3 grid grid-cols-4 gap-2 relative">
          <span id="navIndicator" class="absolute bottom-2 left-0 h-1 rounded-full bg-sky-400/80 transition-all duration-300" style="transform: translateX(0); width: 0;"></span>
          <button data-tab="dashboard" class="nav-btn tab-active rounded-xl py-2 flex flex-col items-center gap-1 relative z-10">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 12l8-8 8 8v7a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-7z" stroke="currentColor" stroke-width="1.5"/></svg>
            <span class="text-[11px]">Dashboard</span>
          </button>
          <button data-tab="collections" class="nav-btn rounded-xl py-2 flex flex-col items-center gap-1 relative z-10">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M6 11h12M8 15h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            <span class="text-[11px]">Collections</span>
          </button>
          <button data-tab="portals" class="nav-btn rounded-xl py-2 flex flex-col items-center gap-1 relative z-10">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            <span class="text-[11px]">Portals</span>
          </button>
          <button data-tab="profile" class="nav-btn rounded-xl py-2 flex flex-col items-center gap-1 relative z-10">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="3.2" stroke="currentColor" stroke-width="1.5"/><path d="M4.5 19c1.8-3.2 5-5 7.5-5s5.7 1.8 7.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
            <span class="text-[11px]">Profile</span>
          </button>
        </div>
      </div>
    </nav>
  </div>

  <!-- Admin Page -->
  <div id="adminWrapper" class="max-w-7xl mx-auto min-h-screen flex flex-col relative hidden">
    <header class="sticky top-0 z-40 px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4 glass">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl grid place-items-center" style="background: linear-gradient(180deg,#8b5cf6,#6d28d9); box-shadow: 0 6px 18px rgba(139,92,246,.35);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4 4h16v16H4z" stroke="white" opacity=".9" stroke-width="1.5"/></svg>
          </div>
          <div>
            <div class="text-xs uppercase tracking-wider text-slate-300">VirtuShoot Admin</div>
            <h2 class="text-lg font-bold">Panel Admin</h2>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button id="backToApp" class="btn rounded-xl px-4 py-2 text-sm">Kembali ke App</button>
        </div>
      </div>
    </header>

    <main class="flex-1 px-4 sm:px-6 py-6 space-y-6">
      <div class="glass rounded-2xl p-5">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold">Statistik</h3>
          <span class="text-xs text-slate-400 hidden md:inline">Optimal di layar lebar</span>
        </div>
        <div id="statsGrid" class="grid sm:grid-cols-3 lg:grid-cols-5 gap-3"></div>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <!-- Kelola Kategori & User -->
        <div class="glass rounded-2xl p-5 space-y-3">
          <div class="flex items-center justify-between">
            <h4 class="font-semibold">Kategori</h4>
            <div class="flex gap-2">
              <input id="newCategoryName" placeholder="Tambah kategori..." class="rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
              <button id="addCategoryBtn" class="btn rounded-xl px-4 py-3">Tambah</button>
            </div>
          </div>
          <div id="adminCategoryList" class="space-y-2"></div>

          <hr class="border-white/10 my-3">

          <div class="flex items-center justify-between">
            <h4 class="font-semibold">User Lokal</h4>
            <div class="flex gap-2">
              <input id="newUserName" placeholder="Nama user..." class="rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
              <button id="addUserBtn" class="btn rounded-xl px-4 py-3">Tambah</button>
            </div>
          </div>
          <div id="adminUserList" class="space-y-2"></div>
          <p class="text-xs text-slate-400">Semua data hanya di perangkat ini.</p>
        </div>

        <!-- Upload Pose -->
        <div class="glass rounded-2xl p-5 space-y-4">
          <div class="flex items-center justify-between">
            <h4 class="font-semibold">Upload Pose</h4>
            <div class="text-xs text-slate-400 hidden md:block">Tip: Seret file langsung ke kotak</div>
          </div>

          <div class="grid sm:grid-cols-3 gap-3">
            <select id="adminCategory" class="rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"></select>
            <input id="adminFiles" type="file" accept="image/*" multiple class="rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
            <button id="adminUploadBtn" class="btn rounded-xl px-4 py-3">Upload</button>
          </div>

          <div id="dropZone" class="rounded-2xl border border-dashed border-white/20 bg-white/5 p-6 text-center transition shadow-inner">
            <div class="text-slate-200 font-medium">Seret & letakkan foto di sini</div>
            <div class="text-xs text-slate-400">atau gunakan tombol pilih file</div>
          </div>

          <div id="pendingPreview" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2"></div>
        </div>
      </div>

      <!-- Pratinjau -->
      <div class="glass rounded-2xl p-5 space-y-3">
        <div class="flex items-center justify-between">
          <h4 class="font-semibold">Pratinjau Kategori & Foto</h4>
          <button id="refreshPreviewBtn" class="btn rounded-xl px-3 py-2 text-sm">Segarkan</button>
        </div>
        <div id="adminPreview" class="grid md:grid-cols-3 gap-4"></div>
      </div>

      <!-- Server Sync (Demo) + Mode Log -->
      <div class="glass rounded-2xl p-5 space-y-4">
        <div class="flex items-center justify-between">
          <h4 class="font-semibold">Server Sync (Demo)</h4>
          <span class="text-xs text-slate-400">Masukkan URL server kamu</span>
        </div>
        <div class="grid md:grid-cols-3 gap-3">
          <input id="serverUrl" placeholder="https://domainkamu.com/api/sync" class="md:col-span-2 rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60" />
          <button id="btnTestServer" class="btn rounded-xl px-4 py-3">Tes Koneksi</button>
        </div>
        <div class="flex items-center justify-between">
          <label class="flex items-center gap-2 text-sm text-slate-300">
            <input id="chkAutoSync" type="checkbox" class="accent-sky-400" />
            Aktifkan sync otomatis setelah Upload/Kategori diubah
          </label>
          <div class="flex items-center gap-3">
            <label class="flex items-center gap-2 text-sm text-slate-300">
              <input id="chkLog" type="checkbox" class="accent-sky-400" />
              Mode Log
            </label>
            <button id="btnSyncNow" class="btn rounded-xl px-4 py-2 text-sm">Kirim Data Sekarang</button>
            <button id="btnClearServerUrl" class="chip rounded-xl px-4 py-2 text-sm">Bersihkan</button>
          </div>
        </div>
        <div id="logBlock" class="hidden space-y-2">
          <div class="flex items-center justify-between">
            <div class="text-xs text-slate-400">Log Sinkronisasi (Realtime)</div>
            <div class="flex items-center gap-2">
              <span id="logStatus" class="text-xs text-slate-400">Idle</span>
              <button id="btnClearLog" class="chip rounded-xl px-3 py-1 text-xs">Bersihkan Log</button>
            </div>
          </div>
          <div id="serverLog" class="rounded-xl bg-black/30 border border-white/10 p-3 text-[12px] leading-5 font-mono max-h-48 overflow-auto"></div>
        </div>
        <p class="text-xs text-slate-400">Catatan: Ini contoh pengiriman. Kamu perlu menyiapkan endpoint yang menerima JSON (POST). Respon server mungkin dibatasi oleh kebijakan CORS.</p>
      </div>
    </main>
  </div>

  <!-- Templates -->
  <template id="categoryItemTemplate">
    <div class="glass rounded-2xl p-3 flex items-center gap-3 hover:brightness-110 transition cursor-pointer">
      <div class="w-16 h-14 rounded-xl relative overflow-hidden bg-white/5">
        <div class="w-full h-full grid grid-cols-2 gap-0.5 opacity-60">
          <div class="bg-sky-400/40"></div>
          <div class="bg-violet-500/40"></div>
          <div class="bg-indigo-500/40"></div>
          <div class="bg-cyan-500/40"></div>
        </div>
      </div>
      <div class="flex-1">
        <div class="text-sm uppercase tracking-wide text-slate-300">Pose</div>
        <div class="font-semibold text-base">Nama</div>
      </div>
      <button class="btn rounded-xl px-3 py-2 text-sm">Lihat</button>
    </div>
  </template>

  <template id="photoCardTemplate">
    <div class="relative rounded-xl overflow-hidden">
      <img class="w-full h-32 object-cover block" alt="pose"/>
      <button class="absolute top-2 right-2 rounded-full bg-black/40 hover:bg-black/55 p-2">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path class="heart-path" d="M12 21s-7.5-4.4-9-8.8C2 7.9 4.4 6 6.8 6c1.5 0 2.8.8 3.2 2 .4-1.2 1.7-2 3.2-2C15.6 6 18 7.9 21 12.2 19.5 16.6 12 21 12 21z" stroke="white" stroke-width="1.4" fill="transparent"/>
        </svg>
      </button>
    </div>
  </template>

  <script>
    // Keys & defaults
    const AUTH = { USERS:'vs_auth_users_demo', SESSION:'vs_auth_session_demo' };
    const LS_KEYS = { CATEGORIES:'vs_categories', PHOTOS:'vs_photos', FAVS:'vs_favorites', PROFILE:'vs_profile', PROFILE_PHOTO:'vs_profile_photo', PORTALS:'vs_portals', USERS:'vs_users_local', SERVER_URL:'vs_server_url', AUTO_SYNC:'vs_auto_sync', LOG_ON:'vs_log_on' };
    const defaultCategories = ["PERUSAHAAN","PASANGAN","PERTUNANGAN","KELUARGA","PERSAHABATAN","BAYI BARU LAHIR","PEMODELAN","PERNIKAHAN","WISUDA"];
    const ADMIN_EMAIL = 'virtushootapps@gmail.com';

    // Storage helpers
    const getAuthUsers = () => JSON.parse(localStorage.getItem(AUTH.USERS) || '[]');
    const setAuthUsers = (v) => localStorage.setItem(AUTH.USERS, JSON.stringify(v));
    const getSession = () => JSON.parse(localStorage.getItem(AUTH.SESSION) || 'null');
    const setSession = (v) => localStorage.setItem(AUTH.SESSION, JSON.stringify(v));

    const getCategories = () => JSON.parse(localStorage.getItem(LS_KEYS.CATEGORIES) || '[]');
    const setCategories = (v) => localStorage.setItem(LS_KEYS.CATEGORIES, JSON.stringify(v));
    const getPhotos = () => JSON.parse(localStorage.getItem(LS_KEYS.PHOTOS) || '{}');
    const setPhotos = (v) => localStorage.setItem(LS_KEYS.PHOTOS, JSON.stringify(v));
    const getFavs = () => JSON.parse(localStorage.getItem(LS_KEYS.FAVS) || '[]');
    const setFavs = (v) => localStorage.setItem(LS_KEYS.FAVS, JSON.stringify(v));
    const getProfile = () => JSON.parse(localStorage.getItem(LS_KEYS.PROFILE) || '{}');
    const setProfile = (v) => localStorage.setItem(LS_KEYS.PROFILE, JSON.stringify(v));
    const getUsersStore = () => JSON.parse(localStorage.getItem(LS_KEYS.USERS) || '[]');
    const setUsersStore = (v) => localStorage.setItem(LS_KEYS.USERS, JSON.stringify(v));
    const getPortals = () => JSON.parse(localStorage.getItem(LS_KEYS.PORTALS) || '[]');
    const setPortals = (v) => localStorage.setItem(LS_KEYS.PORTALS, JSON.stringify(v));

    // Toast
    function softToast(msg){
      const t = document.createElement('div');
      t.className = `fixed left-1/2 -translate-x-1/2 bottom-24 z-[60] px-4 py-2 rounded-xl text-sm glass`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(()=> t.classList.add('fade-in'), 10);
      setTimeout(()=> t.remove(), 1800);
    }

    // SIMPLE VIEWER (modal pratinjau gambar)
    let viewerEl = null, viewerImg = null, viewerIdx = 0, viewerList = [];
    function ensureViewer(){
      if (viewerEl) return;
      viewerEl = document.createElement('div');
      viewerEl.className = 'fixed inset-0 z-[70] hidden';
      viewerEl.innerHTML = `
        <div class="absolute inset-0 bg-black/80"></div>
        <div class="absolute inset-0 flex items-center justify-center p-4">
          <div class="relative max-w-3xl w-full">
            <img id="_vImg" class="w-full max-h-[78vh] object-contain rounded-xl shadow-2xl" alt="preview"/>
            <button id="_vClose" class="absolute -top-4 -right-4 btn-red rounded-full w-10 h-10 grid place-items-center">âœ•</button>
            <button id="_vPrev" class="absolute left-0 top-1/2 -translate-y-1/2 chip rounded-full w-10 h-10 grid place-items-center">â€¹</button>
            <button id="_vNext" class="absolute right-0 top-1/2 -translate-y-1/2 chip rounded-full w-10 h-10 grid place-items-center">â€º</button>
          </div>
        </div>`;
      document.body.appendChild(viewerEl);
      viewerImg = viewerEl.querySelector('#_vImg');
      viewerEl.querySelector('#_vClose').addEventListener('click', hideViewer);
      viewerEl.addEventListener('click', (e)=>{ if (e.target===viewerEl || e.target.classList.contains('bg-black/80')) hideViewer(); });
      viewerEl.querySelector('#_vPrev').addEventListener('click', ()=> navViewer(-1));
      viewerEl.querySelector('#_vNext').addEventListener('click', ()=> navViewer(1));
      window.addEventListener('keydown', (e)=>{
        if (viewerEl.classList.contains('hidden')) return;
        if (e.key==='Escape') hideViewer();
        if (e.key==='ArrowLeft') navViewer(-1);
        if (e.key==='ArrowRight') navViewer(1);
      });
    }
    function showViewer(list, start=0){
      ensureViewer();
      viewerList = list || [];
      viewerIdx = Math.max(0, Math.min(start, viewerList.length-1));
      updateViewer();
      viewerEl.classList.remove('hidden');
    }
    function hideViewer(){ viewerEl?.classList.add('hidden'); }
    function navViewer(step){
      if (!viewerList.length) return;
      viewerIdx = (viewerIdx + step + viewerList.length) % viewerList.length;
      updateViewer();
    }
    function updateViewer(){ if (viewerImg && viewerList[viewerIdx]) viewerImg.src = viewerList[viewerIdx]; }

    // Elements
    const authWrapper = document.getElementById('authWrapper');
    const appWrapper = document.getElementById('appWrapper');
    const adminWrapper = document.getElementById('adminWrapper');
    const goAdminBtn = document.getElementById('goAdmin');
    const backToApp = document.getElementById('backToApp');

    // Auth tabs
    const tabSignIn = document.getElementById('tabSignIn');
    const tabCreate = document.getElementById('tabCreate');
    const panelSignIn = document.getElementById('panelSignIn');
    const panelCreate = document.getElementById('panelCreate');
    function switchAuthTab(name){
      if (name==='signin'){ tabSignIn.classList.add('tab-active'); tabCreate.classList.remove('tab-active'); panelSignIn.classList.remove('hidden'); panelCreate.classList.add('hidden');}
      else { tabCreate.classList.add('tab-active'); tabSignIn.classList.remove('tab-active'); panelCreate.classList.remove('hidden'); panelSignIn.classList.add('hidden');}
    }
    tabSignIn.addEventListener('click', ()=> switchAuthTab('signin'));
    tabCreate.addEventListener('click', ()=> switchAuthTab('create'));

    // Sign-in / Create
    const siName = document.getElementById('siName');
    const siEmail = document.getElementById('siEmail');
    const btnSignIn = document.getElementById('btnSignIn');
    const siSpinner = document.getElementById('siSpinner');
    const caName = document.getElementById('caName');
    const caEmail = document.getElementById('caEmail');
    const btnCreate = document.getElementById('btnCreate');
    const caSpinner = document.getElementById('caSpinner');

    function validateEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

    btnSignIn.addEventListener('click', ()=>{
      const email = (siEmail.value||'').trim().toLowerCase();
      if (!validateEmail(email)) return softToast('Email tidak valid');
      btnSignIn.disabled = true; siSpinner.classList.remove('hidden');
      setTimeout(()=>{
        const users = getAuthUsers();
        const registered = users.find(u=> u.email===email);
        if (!registered) {
          softToast('Email belum terdaftar. Silakan daftar dulu.');
          switchAuthTab('create');
          const caEmailField = document.getElementById('caEmail');
          if (caEmailField) caEmailField.value = email;
          btnSignIn.disabled=false; siSpinner.classList.add('hidden');
          return;
        }
        const inputNameVal = siName.value?.trim() || '';
        const displayName = registered.name || inputNameVal || (email.split('@')[0]);
        setSession({name: displayName, email}); if (!getProfile().name) setProfile({name: displayName, bio:'', avatar:'ðŸ“·'});
        const isAdmin = email===ADMIN_EMAIL;
        if (isAdmin) { switchTo('admin'); initAdmin(); softToast('Masuk sebagai Admin'); }
        else { switchTo('app'); afterLoginSetup(); softToast('Selamat datang!'); }
        btnSignIn.disabled = false; siSpinner.classList.add('hidden');
      }, 400);
    });

    btnCreate.addEventListener('click', ()=>{
      const name = (caName.value||'').trim();
      const email = (caEmail.value||'').trim().toLowerCase();
      if (!name) return softToast('Nama belum diisi');
      if (!validateEmail(email)) return softToast('Email tidak valid');
      btnCreate.disabled = true; caSpinner.classList.remove('hidden');
      setTimeout(()=>{
        const users = getAuthUsers();
        if (users.find(u=> u.email===email)) { softToast('Email sudah terdaftar'); switchAuthTab('signin'); siEmail.value=email; siName.value=name; }
        else { users.push({name,email}); setAuthUsers(users); softToast('Profil dibuat. Silakan masuk.'); switchAuthTab('signin'); siEmail.value=email; siName.value=name; }
        btnCreate.disabled = false; caSpinner.classList.add('hidden');
      }, 450);
    });

    // App navigation & content
    const tabs = ['dashboard','collections','portals','profile'];
    const sections = {
      dashboard: document.getElementById('tab-dashboard'),
      collections: document.getElementById('tab-collections'),
      portals: document.getElementById('tab-portals'),
      profile: document.getElementById('tab-profile')
    };
    const categoryList = document.getElementById('categoryList');
    const categoryItemTemplate = document.getElementById('categoryItemTemplate');
    const photoCardTemplate = document.getElementById('photoCardTemplate');
    const categoryScreen = document.getElementById('categoryScreen');
    const categoryTitle = document.getElementById('categoryTitle');
    const categoryGrid = document.getElementById('categoryGrid');

    function renderCategories(filterText='') {
      const cats = getCategories();
      const photos = getPhotos();
      categoryList.innerHTML = '';
      const filtered = cats.filter(c => c.toLowerCase().includes(filterText.toLowerCase()));
      filtered.forEach(cat => {
        const tpl = categoryItemTemplate.content.cloneNode(true);
        tpl.querySelector('.font-semibold').textContent = cat;
        const container = tpl.querySelector('.glass');
        container.addEventListener('click', ()=> openCategory(cat, photos[cat]||[]));
        tpl.querySelector('button').addEventListener('click', (e)=> { e.stopPropagation(); openCategory(cat, photos[cat]||[]); });
        categoryList.appendChild(tpl);
      });
      document.getElementById('emptyCategoriesHint').classList.toggle('hidden', filtered.length>0);
    }
    function openCategory(cat, list) {
      Object.values(sections).forEach(s=> s.classList.add('hidden'));
      categoryScreen.classList.remove('hidden'); categoryScreen.classList.add('fade-in');
      categoryTitle.textContent = cat; renderCategoryGrid(list);
    }
    function renderCategoryGrid(list) {
      const favs = new Set(getFavs());
      categoryGrid.innerHTML = '';
      const urls = list.map(i=> i.url);
      list.forEach((item, idx)=>{
        const node = photoCardTemplate.content.cloneNode(true);
        const imgEl = node.querySelector('img');
        imgEl.src = item.url;
        imgEl.addEventListener('click', ()=> showViewer(urls, idx));
        const heartPath = node.querySelector('.heart-path');
        const btn = node.querySelector('button');
        const isFav = favs.has(item.id);
        if (isFav) { heartPath.setAttribute('fill','#ef4444'); btn.classList.add('active'); }
        btn.addEventListener('click', (e)=> {
          e.stopPropagation(); toggleFav(item.id);
          const favNow = new Set(getFavs()).has(item.id);
          heartPath.setAttribute('fill', favNow ? '#ef4444' : 'transparent');
          btn.classList.toggle('active', favNow); renderCollections();
        });
        categoryGrid.appendChild(node);
      });
      document.getElementById('emptyGrid').classList.toggle('hidden', list.length>0);
    }
    document.getElementById('backToDash').addEventListener('click', ()=> switchTab('dashboard'));
    function toggleFav(id){ const favs = new Set(getFavs()); if (favs.has(id)) favs.delete(id); else favs.add(id); setFavs(Array.from(favs)); }
    function renderCollections(){
      const grid = document.getElementById('collectionsGrid');
      const favs = new Set(getFavs()); const photos = getPhotos(); const all = [];
      Object.values(photos).forEach(list=> list.forEach(p=> { if (favs.has(p.id)) all.push(p); }));
      grid.innerHTML = '';
      const urls = all.map(i=> i.url);
      all.forEach((item, idx)=>{
        const node = photoCardTemplate.content.cloneNode(true);
        const imgEl = node.querySelector('img');
        imgEl.src = item.url;
        imgEl.addEventListener('click', ()=> showViewer(urls, idx));
        const heartPath = node.querySelector('.heart-path'); heartPath.setAttribute('fill','#ef4444');
        node.querySelector('button').addEventListener('click', (e)=> { e.stopPropagation(); toggleFav(item.id); renderCollections(); });
        grid.appendChild(node);
      });
      document.getElementById('emptyFavs').classList.toggle('hidden', all.length>0);
    }

    // Profile
    const profileName = document.getElementById('profileName');
    const inputName = document.getElementById('inputName');
    const inputBio = document.getElementById('inputBio');
    const saveProfile = document.getElementById('saveProfile');
    const avatar = document.getElementById('avatar');
    saveProfile.addEventListener('click', ()=> { setProfile({ name: inputName.value || 'Fotografer Tanpa Nama', bio: inputBio.value || '' }); loadProfile(); softToast('Profil tersimpan'); });
    function loadProfile(){
      const p = getProfile();
      profileName.textContent = p.name || 'Fotografer Tanpa Nama';
      inputName.value = p.name || '';
      inputBio.value = p.bio || '';
      const photo = localStorage.getItem(LS_KEYS.PROFILE_PHOTO);
      if (photo) {
        avatar.style.backgroundImage = `url(${photo})`;
        avatar.style.backgroundSize = 'cover';
        avatar.style.backgroundPosition = 'center';
      } else {
        avatar.style.backgroundImage = 'none';
      }
      const profilePhotoPreview = document.getElementById('profilePhotoPreview');
      if (profilePhotoPreview) {
        if (photo) { profilePhotoPreview.src = photo; profilePhotoPreview.classList.remove('bg-white/10'); }
        else { profilePhotoPreview.src = ''; profilePhotoPreview.classList.add('bg-white/10'); }
      }
    }
    const profilePhotoInput = document.getElementById('profilePhotoInput');
    document.getElementById('choosePhoto').addEventListener('click', ()=> profilePhotoInput.click());
    document.getElementById('removePhoto').addEventListener('click', ()=> { localStorage.removeItem(LS_KEYS.PROFILE_PHOTO); loadProfile(); softToast('Foto profil dihapus'); });
    profilePhotoInput.addEventListener('change', ()=>{
      const file = profilePhotoInput.files && profilePhotoInput.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) { softToast('Pilih gambar'); return; }
      const reader = new FileReader();
      reader.onload = ()=> { localStorage.setItem(LS_KEYS.PROFILE_PHOTO, reader.result); loadProfile(); softToast('Foto profil disimpan'); };
      reader.readAsDataURL(file);
    });

    // Quick actions
    document.getElementById('qaNewPortal').addEventListener('click', ()=>{ switchTab('portals'); openPortalModal(); });
    document.getElementById('qaCollections').addEventListener('click', ()=> switchTab('collections'));
    document.getElementById('qaSuggest').addEventListener('click', ()=> {
      const photos = getPhotos(); const pool = Object.values(photos).flat();
      const picks = pool.sort(()=>0.5-Math.random()).slice(0,8);
      const grid = document.getElementById('collectionsGrid'); switchTab('collections'); grid.innerHTML = '';
      const urls = picks.map(i=> i.url);
      picks.forEach((item, idx)=>{
        const node = photoCardTemplate.content.cloneNode(true);
        const imgEl = node.querySelector('img');
        imgEl.src = item.url;
        imgEl.addEventListener('click', ()=> showViewer(urls, idx));
        const heartPath = node.querySelector('.heart-path');
        node.querySelector('button').addEventListener('click', (e)=> {
          e.stopPropagation(); toggleFav(item.id);
          const favNow = new Set(getFavs()).has(item.id);
          heartPath.setAttribute('fill', favNow ? '#ef4444' : 'transparent');
        });
        grid.appendChild(node);
      });
      document.getElementById('emptyFavs').classList.toggle('hidden', picks.length>0);
    });
    document.getElementById('searchInput').addEventListener('input', (e)=> { if (!sections.dashboard.classList.contains('hidden')) renderCategories(e.target.value); });

    // Portals
    const portalList = document.getElementById('portalList');
    function openPortalModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="relative max-w-md mx-auto mt-16 px-5">
          <div class="glass rounded-2xl p-4 space-y-3 slide-up">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Buat Portal Baru</h3>
              <button class="btn rounded-xl px-3 py-2" id="closePM">Tutup</button>
            </div>
            <input id="pmName" placeholder="Nama Portal (misal: Prewedding A&B)" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"/>
            <select id="pmCategory" class="w-full rounded-xl px-4 py-3 bg-white/10 border border-white/20 focus:outline-none focus:ring-2 focus:ring-sky-400/60"></select>
            <div>
              <p class="text-sm text-slate-300 mb-2">Pilih beberapa foto dari kategori ini:</p>
              <div id="pmGrid" class="grid-auto-fit max-h-60 overflow-auto hidden-scroll"></div>
            </div>
            <button id="pmCreate" class="btn rounded-xl px-4 py-3 w-full">Buat Portal</button>
          </div>
        </div>`;
      document.body.appendChild(modal);
      modal.addEventListener('click', (e)=>{ if (e.target.id==='closePM') modal.remove(); });
      const cats = getCategories(); const sel = modal.querySelector('#pmCategory'); sel.innerHTML = cats.map(c=> `<option>${c}</option>`).join('');
      function updatePick(){ const photos = getPhotos(); const cat = sel.value; const list = photos[cat]||[]; const grid = modal.querySelector('#pmGrid'); grid.innerHTML = '';
        list.forEach(item=>{
          const wrap = document.createElement('div');
          wrap.className = 'relative rounded-xl overflow-hidden cursor-pointer hover:brightness-110 transition';
          wrap.innerHTML = `<img src="${item.url}" class="w-full h-24 object-cover"/><div class="absolute inset-0 ring-2 ring-transparent pointer-events-none rounded-xl"></div>`;
          wrap.addEventListener('click', ()=>{ wrap.classList.toggle('selected'); wrap.querySelector('div').classList.toggle('ring-sky-400'); });
          wrap.dataset.id = item.id; grid.appendChild(wrap);
        });
      }
      sel.addEventListener('change', updatePick); updatePick();
      modal.querySelector('#pmCreate').addEventListener('click', ()=>{
        const name = modal.querySelector('#pmName').value.trim();
        const cat = modal.querySelector('#pmCategory').value;
        const picks = Array.from(modal.querySelectorAll('#pmGrid .selected')).map(n=> n.dataset.id);
        if (!name || picks.length===0) return softToast('Nama portal & pilihan foto wajib');
        const all = getPortals(); const code = Math.random().toString(36).slice(2,8).toUpperCase();
        all.push({ code, name, category:cat, photos:picks, likes:0 }); setPortals(all);
        modal.remove(); renderPortals(); softToast('Portal dibuat');
      });
    }
    function renderPortals() {
      const portals = getPortals(); portalList.innerHTML = '';
      if (portals.length===0) {
        const empty = document.createElement('div'); empty.className = 'empty rounded-xl p-4 text-sm text-slate-300'; empty.textContent = 'Belum ada portal. Buat portal pertama Anda!'; portalList.appendChild(empty); return;
      }
      portals.forEach(p=>{
        const row = document.createElement('div');
        row.className = 'glass rounded-2xl p-3 space-y-3';
        row.innerHTML = `
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs text-slate-300">Kode: ${p.code}</div>
              <div class="font-semibold">${p.name}</div>
              <div class="text-xs text-slate-400">${p.category} â€¢ ${p.photos.length} foto</div>
            </div>
            <div class="flex gap-2">
              <button class="btn rounded-xl px-3 py-2 text-sm viewClient">Tampilan Klien</button>
              <button class="btn-red rounded-xl px-3 py-2 text-sm del">Hapus</button>
            </div>
          </div>
          <div class="grid grid-cols-6 gap-1">
            ${p.photos.slice(0,6).map(id=>{ const img = findPhotoById(id); return `<img src="${img?.url||''}" class="w-full h-12 object-cover rounded-md"/>` }).join('')}
          </div>
          <div class="text-xs text-slate-300">Total Like: <span class="likes">${p.likes||0}</span></div>
        `;
        row.querySelector('.viewClient').addEventListener('click', ()=> openClientView(p.code));
        row.querySelector('.del').addEventListener('click', ()=> {
          if (!confirm('Hapus portal ini?')) return;
          const all = getPortals().filter(x=> x.code!==p.code); setPortals(all); renderPortals();
        });
        portalList.appendChild(row);
      });
    }
    function findPhotoById(id){ const photos = getPhotos(); for (const list of Object.values(photos)){ const f = list.find(x=> x.id===id); if (f) return f; } return null; }
    function openClientView(code) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50';
      modal.innerHTML = `
        <div class="absolute inset-0 bg-black/60"></div>
        <div class="relative max-w-md mx-auto mt-10 px-5">
          <div class="glass rounded-2xl p-4 space-y-3 slide-up">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Tampilan Klien</h3>
              <button id="closeCM" class="btn rounded-xl px-3 py-2">Tutup</button>
            </div>
            <div id="clientGrid" class="grid-auto-fit max-h-[60vh] overflow-auto hidden-scroll"></div>
          </div>
        </div>`;
      document.body.appendChild(modal);
      modal.addEventListener('click', (e)=>{ if (e.target.id==='closeCM') modal.remove(); });
      const portals = getPortals(); const p = portals.find(x=> x.code===code); if (!p) return;
      const clientGrid = modal.querySelector('#clientGrid'); clientGrid.innerHTML = '';
      const urls = p.photos.map(id=> findPhotoById(id)?.url).filter(Boolean);
      p.photos.forEach((id, idx)=>{
        const imgObj = findPhotoById(id);
        const card = document.createElement('div'); card.className = 'relative rounded-xl overflow-hidden';
        card.innerHTML = `<img src="${imgObj?.url||''}" class="w-full h-32 object-cover"/><button class="absolute top-2 right-2 rounded-full bg-black/40 hover:bg-black/55 p-2"><svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 21s-7.5-4.4-9-8.8C2 7.9 4.4 6 6.8 6c1.5 0 2.8.8 3.2 2 .4-1.2 1.7-2 3.2-2C15.6 6 18 7.9 21 12.2 19.5 16.6 12 21 12 21z\" stroke=\"white\" stroke-width=\"1.4\" fill=\"transparent\"/></svg></button>`;
        const imgEl = card.querySelector('img');
        imgEl.addEventListener('click', ()=> showViewer(urls, idx));
        const btn = card.querySelector('button'); let liked = false;
        btn.addEventListener('click', ()=> {
          liked = !liked; const path = btn.querySelector('path'); path.setAttribute('fill', liked ? '#ef4444' : 'transparent');
          const all = getPortals(); const idxP = all.findIndex(xx=> xx.code===code);
          if (idxP>-1) { all[idxP].likes = (all[idxP].likes||0) + (liked?1:-1); setPortals(all); renderPortals(); }
        });
        clientGrid.appendChild(card);
      });
    }

    // Switchers
    function switchTo(mode){
      authWrapper.classList.add('hidden');
      appWrapper.classList.add('hidden');
      adminWrapper.classList.add('hidden');
      if (mode==='auth') authWrapper.classList.remove('hidden');
      if (mode==='app') appWrapper.classList.remove('hidden');
      if (mode==='admin') adminWrapper.classList.remove('hidden');
    }

    // Logout handler
    function doLogout(){
      try { localStorage.removeItem(AUTH.SESSION); } catch(e) {}
      softToast('Anda telah keluar');
      switchTo('auth');
    }
    document.addEventListener('click', (e)=>{
      if (e.target && (e.target.id === 'logoutTop' || e.target.id === 'logoutBottom')) {
        e.preventDefault();
        doLogout();
      }
    });
    const navBar = document.querySelector('nav .glass');
    const navIndicator = document.getElementById('navIndicator');
    function moveIndicatorTo(btn){
      if (!btn || !navIndicator || !navBar) return;
      const btnRect = btn.getBoundingClientRect();
      const barRect = navBar.getBoundingClientRect();
      const x = btnRect.left - barRect.left + 8;
      const w = btnRect.width - 16;
      navIndicator.style.width = w + 'px';
      navIndicator.style.transform = `translateX(${x}px)`;
    }
    document.querySelectorAll('.nav-btn').forEach(btn=> btn.addEventListener('click', ()=> { moveIndicatorTo(btn); switchTab(btn.dataset.tab); }));
    function switchTab(name){
      tabs.forEach(t=> { if (t===name){ sections[t].classList.remove('hidden'); sections[t].classList.add('fade-in'); } else { sections[t].classList.add('hidden'); } });
      categoryScreen.classList.add('hidden');
      if (name==='collections') renderCollections();
      if (name==='portals') renderPortals();
      if (name==='profile') loadProfile();
    }
    window.addEventListener('load', ()=> {
      const activeBtn = document.querySelector('.nav-btn.tab-active') || document.querySelector('.nav-btn');
      moveIndicatorTo(activeBtn);
    });

    // Admin logic
    const adminCategory = document.getElementById('adminCategory');
    const adminFiles = document.getElementById('adminFiles');
    const adminUploadBtn = document.getElementById('adminUploadBtn');
    const newCategoryName = document.getElementById('newCategoryName');
    const addCategoryBtn = document.getElementById('addCategoryBtn');
    const adminUserList = document.getElementById('adminUserList');
    const addUserBtn = document.getElementById('addUserBtn');
    const newUserName = document.getElementById('newUserName');
    const adminPreview = document.getElementById('adminPreview');
    const adminCategoryList = document.getElementById('adminCategoryList');
    const refreshPreviewBtn = document.getElementById('refreshPreviewBtn');
    const statsGrid = document.getElementById('statsGrid');

    // Server sync elements
    const serverUrlInput = document.getElementById('serverUrl');
    const btnTestServer = document.getElementById('btnTestServer');
    const btnSyncNow = document.getElementById('btnSyncNow');
    const btnClearServerUrl = document.getElementById('btnClearServerUrl');
    const chkAutoSync = document.getElementById('chkAutoSync');
    const chkLog = document.getElementById('chkLog');
    const logBlock = document.getElementById('logBlock');
    const serverLog = document.getElementById('serverLog');
    const logStatus = document.getElementById('logStatus');
    const btnClearLog = document.getElementById('btnClearLog');

    // Log helpers
    function isLogOn(){ return localStorage.getItem(LS_KEYS.LOG_ON) === '1'; }
    function setLogOn(v){ localStorage.setItem(LS_KEYS.LOG_ON, v ? '1':'0'); }
    function setLogUI(on){
      if (!logBlock) return;
      if (on) logBlock.classList.remove('hidden'); else logBlock.classList.add('hidden');
      if (chkLog) chkLog.checked = !!on;
    }
    function addLog(msg, level='info'){
      if (!isLogOn() || !serverLog) return;
      const time = new Date().toLocaleTimeString();
      const color = level==='error' ? '#ef4444' : level==='warn' ? '#f59e0b' : '#22d3ee';
      const line = document.createElement('div');
      line.innerHTML = `<span style="color:${color}">[${time}]</span> ${msg}`;
      serverLog.appendChild(line);
      serverLog.scrollTop = serverLog.scrollHeight;
    }
    function setStatus(text){ if (logStatus) logStatus.textContent = text; }

    function refreshAdminSelectors(){
      const cats = getCategories(); if (!adminCategory) return;
      adminCategory.innerHTML = ''; cats.forEach(c=> { const o=document.createElement('option'); o.value=c; o.textContent=c; adminCategory.appendChild(o); });
    }
    function renderAdminCategories(){
      if (!adminCategoryList) return;
      const cats = getCategories(); adminCategoryList.innerHTML = '';
      cats.forEach((c,idx)=>{
        const row = document.createElement('div'); row.className='chip rounded-xl p-3 flex items-center justify-between';
        row.innerHTML = `
          <div class="font-medium">${c}</div>
          <div class="flex items-center gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm rename">Ubah</button>
            <button class="btn-red rounded-xl px-3 py-2 text-sm remove">Hapus</button>
          </div>`;
        row.querySelector('.rename').addEventListener('click', ()=>{
          const name = prompt('Ubah nama kategori:', c); if (!name) return;
          const cats2 = getCategories(); if (cats2.includes(name)) return alert('Nama kategori sudah ada.');
          const photos = getPhotos(); photos[name] = photos[c] || []; delete photos[c]; setPhotos(photos);
          cats2[idx]=name; setCategories(cats2);
          refreshAdminSelectors(); renderAdminCategories(); renderAdminPreview(); renderCategories();
          addLog(`Kategori diubah: "${c}" âžœ "${name}"`);
        });
        row.querySelector('.remove').addEventListener('click', ()=>{
          if (!confirm('Hapus kategori ini? Foto di dalamnya juga akan hilang.')) return;
          const cats2 = getCategories().filter(x=> x!==c); const photos = getPhotos(); delete photos[c];
          setCategories(cats2); setPhotos(photos);
          refreshAdminSelectors(); renderAdminCategories(); renderAdminPreview(); renderCategories();
          addLog(`Kategori dihapus: "${c}"`, 'warn');
        });
        adminCategoryList.appendChild(row);
      });
    }
    function renderAdminUsers(){
      if (!adminUserList) return;
      const users = getUsersStore(); adminUserList.innerHTML='';
      users.forEach((u,idx)=>{
        const row = document.createElement('div'); row.className='chip rounded-xl p-3 flex items-center justify-between';
        row.innerHTML = `
          <div><div class="font-medium">${u.name}</div><div class="text-xs text-slate-300">Peran: ${u.role}</div></div>
          <div class="flex items-center gap-2">
            <button class="btn rounded-xl px-3 py-2 text-sm role">Ganti Peran</button>
            <button class="btn-red rounded-xl px-3 py-2 text-sm del">Hapus</button>
          </div>`;
        row.querySelector('.role').addEventListener('click', ()=>{
          const next = u.role==='admin' ? 'editor' : u.role==='editor' ? 'viewer' : 'admin';
          const us = getUsersStore(); us[idx].role = next; setUsersStore(us); renderAdminUsers();
          addLog(`Peran user "${u.name}" diubah ke ${next}`);
        });
        row.querySelector('.del').addEventListener('click', ()=>{
          const us = getUsersStore().filter((_,i)=> i!==idx); setUsersStore(us); renderAdminUsers();
          addLog(`User "${u.name}" dihapus`, 'warn');
        });
        adminUserList.appendChild(row);
      });
    }
    if (addUserBtn) addUserBtn.addEventListener('click', ()=>{
      const name=(newUserName.value||'').trim(); if(!name) return;
      const us=getUsersStore(); us.push({name, role:'viewer'}); setUsersStore(us); newUserName.value=''; renderAdminUsers();
      addLog(`User baru ditambahkan: "${name}"`);
    });

    if (addCategoryBtn) addCategoryBtn.addEventListener('click', ()=>{
      const name=(newCategoryName.value||'').trim(); if(!name) return;
      const cats=getCategories(); if(cats.includes(name)) { softToast('Kategori sudah ada'); return; }
      cats.push(name); setCategories(cats); newCategoryName.value=''; refreshAdminSelectors(); renderAdminCategories(); renderAdminPreview(); renderCategories(); autoSyncMaybe();
      addLog(`Kategori baru ditambahkan: "${name}"`);
    });

    // Upload with DnD + kompresi
    const dropZone = document.getElementById('dropZone');
    const pendingPreview = document.getElementById('pendingPreview');
    let pendingFiles = [];
    function addPendingFiles(files){
      const arr = Array.from(files || []);
      arr.forEach(file=>{
        if (!file.type.startsWith('image/')) return;
        pendingFiles.push(file);
        const fr = new FileReader();
        fr.onload = ()=> {
          const img = document.createElement('img');
          img.src = fr.result; img.className='w-full h-16 object-cover rounded-lg';
          const wrap = document.createElement('div'); wrap.className='relative'; wrap.appendChild(img);
          const close = document.createElement('button'); close.textContent='âœ•'; close.className='absolute -top-2 -right-2 bg-black/60 text-white rounded-full w-6 h-6 text-xs';
          close.addEventListener('click', ()=> { pendingFiles = pendingFiles.filter(f=> f!==file); wrap.remove(); });
          wrap.appendChild(close); pendingPreview.appendChild(wrap);
        };
        fr.readAsDataURL(file);
      });
    }
    if (dropZone){
      ['dragenter','dragover'].forEach(evt=> dropZone.addEventListener(evt, (e)=> { e.preventDefault(); dropZone.classList.add('ring-2','ring-sky-400'); }));
      ['dragleave','drop'].forEach(evt=> dropZone.addEventListener(evt, (e)=> { e.preventDefault(); dropZone.classList.remove('ring-2','ring-sky-400'); }));
      dropZone.addEventListener('drop', (e)=> { addPendingFiles(e.dataTransfer.files); });
    }
    if (adminFiles) adminFiles.addEventListener('change', (e)=> addPendingFiles(e.target.files));

    if (adminUploadBtn) adminUploadBtn.addEventListener('click', async ()=>{
      const cat = adminCategory.value; if (!cat) return softToast('Pilih kategori');
      if (pendingFiles.length===0 && (!adminFiles.files || adminFiles.files.length===0)) return softToast('Pilih atau seret file dulu');
      const files = pendingFiles.length>0 ? pendingFiles : Array.from(adminFiles.files || []);

      // Kompresi gambar
      const compress = (file)=> new Promise((resolve)=>{
        const reader = new FileReader();
        reader.onload = ()=>{
          const img = new Image();
          img.onload = ()=>{
            let w = img.width, h = img.height;
            const maxW = 1600, maxH = 1600;
            const scale = Math.min(maxW / w, maxH / h, 1);
            const cw = Math.round(w * scale), ch = Math.round(h * scale);
            const canvas = document.createElement('canvas');
            canvas.width = cw; canvas.height = ch;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, cw, ch);
            const q = file.size > 900*1024 ? 0.8 : 0.9;
            const dataUrl = canvas.toDataURL('image/jpeg', q);
            resolve(dataUrl);
          };
          img.src = reader.result;
        };
        reader.readAsDataURL(file);
      });

      softToast('Mengompresi foto...');
      const items = await Promise.all(files.map(async (file)=>{
        const url = await compress(file);
        return { id: `${cat}-${Date.now()}-${Math.random().toString(36).slice(2,7)}`, url };
      }));

      const photos = getPhotos(); photos[cat] = (photos[cat] || []).concat(items); setPhotos(photos);
      pendingFiles = []; pendingPreview.innerHTML=''; if (adminFiles) adminFiles.value = '';
      softToast('Upload selesai!'); renderAdminPreview(); autoSyncMaybe();
      addLog(`Upload selesai: ${items.length} foto ke kategori "${cat}"`);
    });

    function renderAdminPreview(){
      if (!adminPreview) return;
      const photos = getPhotos(); adminPreview.innerHTML = '';
      const entries = Object.entries(photos);
      if (entries.length===0) {
        const empty = document.createElement('div'); empty.className='empty rounded-2xl p-4 text-slate-300 text-sm';
        empty.textContent = 'Belum ada foto sama sekali. Unggah beberapa untuk melihat pratinjau.';
        adminPreview.appendChild(empty); return;
      }
      entries.forEach(([cat,list])=>{
        const box = document.createElement('div'); box.className='chip rounded-2xl p-3';
        box.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="font-semibold">${cat}</div>
            <div class="text-xs text-slate-300">${list.length} foto</div>
          </div>
          <div class="grid grid-cols-6 gap-1">${list.slice(0,12).map(i=> `<img src="${i.url}" class="w-full h-14 object-cover rounded-md"/>`).join('')}</div>
        `;
        adminPreview.appendChild(box);
      });
    }

    function renderAdminStats(){
      const users = getUsersStore(); const cats = getCategories(); const photos = getPhotos(); const favs = getFavs(); const portals = getPortals();
      const photoCount = Object.values(photos).reduce((a,b)=> a + b.length, 0);
      const items = [
        { label:'User', value: users.length, color:'#22d3ee' },
        { label:'Kategori', value: cats.length, color:'#8b5cf6' },
        { label:'Foto', value: photoCount, color:'#10b981' },
        { label:'Favorit', value: favs.length, color:'#f59e0b' },
        { label:'Portals', value: portals.length, color:'#ef4444' },
      ];
      statsGrid.innerHTML = items.map(i=> `
        <div class="rounded-2xl p-4 glass">
          <div class="text-xs text-slate-300 mb-1">${i.label}</div>
          <div class="text-2xl font-extrabold" style="color:${i.color}">${i.value}</div>
        </div>`).join('');
    }

    // ---- Server Sync (Demo) ----
    function getServerUrl(){ return localStorage.getItem(LS_KEYS.SERVER_URL) || ''; }
    function setServerUrl(v){ localStorage.setItem(LS_KEYS.SERVER_URL, v||''); }
    function getAutoSync(){ return localStorage.getItem(LS_KEYS.AUTO_SYNC) === '1'; }
    function setAutoSync(v){ localStorage.setItem(LS_KEYS.AUTO_SYNC, v ? '1':'0'); }

    function buildPayload(){
      return {
        meta: {
          app: 'VirtuShoot',
          version: 'demo-sync-1',
          ts: Date.now(),
        },
        data: {
          categories: getCategories(),
          photos: getPhotos(),
          favorites: getFavs(),
          profile: getProfile(),
          portals: getPortals(),
          users: getUsersStore(),
        }
      };
    }

    async function sendToServer(url){
      if (!url) throw new Error('URL kosong');
      const payload = buildPayload();
      const size = new Blob([JSON.stringify(payload)]).size;
      addLog(`Mengirim data (${(size/1024).toFixed(1)} KB) ke ${url} ...`);
      setStatus('Mengirim...');
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (!res.ok) {
        setStatus('Gagal');
        addLog(`Gagal kirim: status ${res.status}`, 'error');
        throw new Error('Gagal: ' + res.status);
      }
      let json = {};
      try { json = await res.json(); } catch(_) {}
      addLog(`Sukses: respon ${JSON.stringify(json).slice(0,140)}${JSON.stringify(json).length>140?'...':''}`);
      setStatus('Sukses');
      return json;
    }

    function initServerControls(){
      if (serverUrlInput) serverUrlInput.value = getServerUrl();
      if (chkAutoSync) chkAutoSync.checked = getAutoSync();
      setLogUI(isLogOn());

      btnTestServer?.addEventListener('click', async ()=>{
        try {
          const url = (serverUrlInput.value||'').trim(); setServerUrl(url);
          addLog('Tes koneksi dimulai...');
          await sendToServer(url);
          softToast('Koneksi OK (perhatikan CORS di server)');
        } catch(e){ softToast('Gagal konek: ' + (e.message||'')); }
      });

      btnSyncNow?.addEventListener('click', async ()=>{
        try {
          const url = (serverUrlInput.value||'').trim(); setServerUrl(url);
          await sendToServer(url);
          softToast('Data dikirim ke server');
        } catch(e){ softToast('Gagal kirim: ' + (e.message||'')); }
      });

      btnClearServerUrl?.addEventListener('click', ()=>{
        serverUrlInput.value = ''; setServerUrl(''); softToast('URL dibersihkan'); addLog('URL server dibersihkan', 'warn');
      });

      chkAutoSync?.addEventListener('change', ()=>{
        setAutoSync(chkAutoSync.checked);
        addLog(`Auto sync: ${chkAutoSync.checked ? 'ON' : 'OFF'}`);
      });

      chkLog?.addEventListener('change', ()=>{
        setLogOn(chkLog.checked);
        setLogUI(chkLog.checked);
        if (chkLog.checked) addLog('Mode Log diaktifkan');
      });

      btnClearLog?.addEventListener('click', ()=>{
        if (serverLog) serverLog.innerHTML = '';
        setStatus('Idle');
        softToast('Log dibersihkan');
      });
    }

    async function autoSyncMaybe(){
      if (!getAutoSync()) return;
      const url = getServerUrl(); if (!url) return;
      try { await sendToServer(url); softToast('Tersinkron ke server'); } catch(_){ addLog('Auto sync gagal (lihat CORS/server)', 'warn'); }
    }

    function afterLoginSetup(){ renderCategories(); renderPortals(); refreshAdminSelectors(); loadProfile(); renderAdminStats(); }
    function initAdmin(){
      refreshAdminSelectors(); renderAdminCategories(); renderAdminUsers(); renderAdminPreview(); renderAdminStats();
    }

    // Init storage (tanpa foto bawaan)
    function initStorage(){
      // Pastikan kategori ada; jika kosong, isi dengan default
      const cats = getCategories();
      if (!Array.isArray(cats) || cats.length === 0) {
        setCategories(defaultCategories);
      }
      // Kosongkan foto & favorit seperti permintaan sebelumnya
      setPhotos({});
      setFavs([]);
      // Inisialisasi data lain jika belum ada
      if (!localStorage.getItem(LS_KEYS.PROFILE)) setProfile({name:'Fotografer Tanpa Nama', bio:'', avatar:'ðŸ“·'});
      if (!localStorage.getItem(LS_KEYS.PORTALS)) localStorage.setItem(LS_KEYS.PORTALS, JSON.stringify([]));
      if (!localStorage.getItem(LS_KEYS.USERS)) setUsersStore([{name:'Admin Lokal', role:'admin'}]);
      if (!localStorage.getItem(AUTH.USERS)) setAuthUsers([]);
    }

    function init(){
      initStorage();
      const params = new URLSearchParams(location.search);
      const forceAdmin = params.get('admin') === '1';
      const session = getSession();
      if (forceAdmin) { switchTo('admin'); initAdmin(); }
      else if (session && session.email) { switchTo('app'); afterLoginSetup(); }
      else { switchTo('auth'); }

      // Loader bar
      const bar = document.getElementById('quickLoaderBar');
      let p=0; const tick=()=>{ p += Math.random()*35+25; if(p>100) p=100; bar.style.width=p+'%'; if(p<100) requestAnimationFrame(tick); else setTimeout(()=> document.getElementById('quickLoader').classList.add('hidden'), 120); };
      requestAnimationFrame(tick);

      // init server controls
      initServerControls();
    }
    init();

    // PWA: service worker inline (cache dasar)
    const swCode = `
      const CACHE = 'vs-cache-v1';
      const ASSETS = ['/', location.href];
      self.addEventListener('install', e=>{
        e.waitUntil(caches.open(CACHE).then(c=> c.addAll(ASSETS)).then(()=> self.skipWaiting()));
      });
      self.addEventListener('activate', e=>{
        e.waitUntil(caches.keys().then(keys=> Promise.all(keys.filter(k=> k!==CACHE).map(k=> caches.delete(k)))));
        self.clients.claim();
      });
      self.addEventListener('fetch', e=>{
        const req = e.request;
        e.respondWith(
          caches.match(req).then(hit=> hit || fetch(req).then(resp=>{
            const copy = resp.clone();
            caches.open(CACHE).then(c=> c.put(req, copy)).catch(()=>{});
            return resp;
          }).catch(()=> hit))
        );
      });
    `;
    const swBlob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(swBlob);
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register(swUrl).catch(()=>{});
    }

    // Manifest inline via blob
    const manifest = {
      name: 'VirtuShoot',
      short_name: 'VirtuShoot',
      start_url: '.',
      display: 'standalone',
      background_color: '#0e1a38',
      theme_color: '#0e1a38',
      icons: [
        { src: 'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%25%22 height=%22100%25%22 rx=%2216%22 fill=%22%230e1a38%22/></svg>', sizes: '192x192', type: 'image/svg+xml' }
      ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type:'application/json'});
    const manifestUrl = URL.createObjectURL(manifestBlob);
    const link = document.createElement('link'); link.rel='manifest'; link.href = manifestUrl; document.head.appendChild(link);

    // PWA install prompt handling
    let deferredPrompt = null;
    const installBtn = document.getElementById('installPWA');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault();
      deferredPrompt = e;
      if (installBtn) installBtn.classList.remove('hidden');
    });
    if (installBtn) installBtn.addEventListener('click', async ()=>{
      if (!deferredPrompt) return;
      installBtn.disabled = true;
      try {
        await deferredPrompt.prompt();
        await deferredPrompt.userChoice;
      } catch(_) {}
      installBtn.classList.add('hidden');
      installBtn.disabled = false;
      deferredPrompt = null;
    });
    window.addEventListener('appinstalled', ()=>{
      if (installBtn) installBtn.classList.add('hidden');
      deferredPrompt = null;
      softToast('Aplikasi terpasang');
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97176aab616a8065',t:'MTc1NTU4MzA4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
